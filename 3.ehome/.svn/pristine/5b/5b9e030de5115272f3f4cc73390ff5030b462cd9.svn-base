var vm = new Vue({
	el:"#app",
	data:{
		urlList:{
			list:"modulelist.html?id=",
			order:"siteorder.html?id=",
			index:"siteindex.html?id=",
			groupbuy:"../groupbuy/groupbuydetail.html?id=",
			phoneicon:"../../images/telphone.png",
			goicon:"../../images/grey_go.png"
		},
		site:{},
		n:0
	},
	mounted:function(){//页面加载之后自动调用，常用于页面渲染
		this.$nextTick(function(){
		var _this = this;
			this.$http.get(interfaceUrl+"/live/getSiteIndex",{userID:userInfo.userID,buildingID:userInfo.buildingID,businessID:getQueryString("id")}).then(function(res){
				_this.site = res.data.data;	
			},function(res){
				alert(res.status)
			});
		})					
	},
	methods:{
    openMore:function(){
				 var _this = this;
			_this.n++;
			if (_this.n%2==1) {
					this.$http.get(interfaceUrl+"/live/getMoreGroupBuy",{
						userID:userInfo.userID,
						buildingID: userInfo.buildingID,
						businessID:getQueryString("id")
					}).then(function(res) {
						if(res.data.code == 1000){
							_this.site.groupBuy=res.data.data
						}
					});
					$(event.target).html("收起");
			}
			else if(_this.n%2==0){
				this.$http.get(interfaceUrl+"/live/getSiteIndex",{
					userID:userInfo.userID,businessID:getQueryString("id"),buildingID:userInfo.buildingID
					}).then(function(res) {
						if(res.data.code == 1000){
							_this.site = res.data.data;
							
						}
					});
					$(event.target).html("查看更多团购");
			}
				
			},
		
	collection:function(business){
				
					 if(business.isCollection==0){
					   this.add_collections(business);	               
					}
					  else if(business.isCollection==1){	
					   this.cancel_collections(business);
					}        
		},
		add_collections:function(business){
			var _this = this;
			this.$http.post(path_add,
				{userID:userInfo.userID,buildingID:userInfo.buildingID,businessID:business.businessID},
				{emulateJSON: true}).then(function(res){
                  _this.item = res.data.data;  
                 business.isCollection = 1;
					  toast('收藏成功');
                      })    
		},
		cancel_collections:function(business){
			var _this = this;
			this.$http.post(path_cancle,
				{userID:userInfo.userID,buildingID:userInfo.buildingID,businessID:business.businessID},
				{emulateJSON: true}).then(function(res){
                  _this.item = res.data.data;
                  business.isCollection = 0;
                 toast('取消收藏');
                  })
			
		}	
	}
});

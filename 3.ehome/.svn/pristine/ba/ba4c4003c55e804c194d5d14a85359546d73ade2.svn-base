<div id="partialContact">
	<div class="grey_top">
		<a href="#" class="fl font12" style="margin-left:10px;" @click="cancel">取消</a>
		选择联系人
		<a href="#" @click="selectOK" class="topic_list_btn4">发送</a>
		<div class="topic_list_btn4_tip">{{selectedCount}}</div>
	</div>
	<div class="main_box">
		<div class="choose_cont" style="height: 100px;">
			<ul>
				<li v-for="item in contactList" v-if="item.isSelected">
					<div class="tupian"><img :src="item.headPicSrc" width="110" height="110"></div>
					<p>{{item.frendName}}</p>
				</li>
				<div class="clear"></div>
			</ul>
		</div>

	</div>
	<div class="choose_title">A</div>
	<div class="main_box" style="padding:0; border-top:1px solid #ececec;">
		<div class="my_message" v-for="item in contactList">
			<div class="my_message_left4 mr12">
				<a href="#" @click="choice(item)">
					<img :src="item.isSelected?choiceIco:unchoiceIco" width="32" height="32">
				</a>
			</div>
			<div class="my_message3">
				<div class="my_message_left"><img :src="item.headPicSrc" width="80" height="80">
				</div>
				<div class="my_message_right">
					&nbsp;&nbsp;{{item.frendName}}
				</div>
				<div class="clear"></div>
			</div>
			<div class="clear"></div>
		</div>
	</div>

	<div class="choose_title">B</div>
	<div class="main_box" style="padding:0; border-top:1px solid #ececec;">
		<div class="my_message">
			<div class="my_message_left4 mr12"><img src="../../images/gx.png" width="32" height="32">
			</div>
			<div class="my_message3">
				<div class="my_message_left"><img src="../../images/pic01.jpg" width="80" height="80">
				</div>
				<div class="my_message_right">
					&nbsp;&nbsp;@我的
				</div>
				<div class="clear"></div>
			</div>
			<div class="clear"></div>
		</div>

		<div class="my_message" style="border-bottom:none;">
			<div class="my_message_left4 mr12"><img src="../../images/gx02.png" width="32" height="32">
			</div>
			<div class="my_message3">
				<div class="my_message_left"><img src="../../images/pic01.jpg" width="80" height="80">
				</div>
				<div class="my_message_right">
					&nbsp;&nbsp;@我的
				</div>
				<div class="clear"></div>
			</div>
		</div>
	</div>
</div>
<script>
	$('#partialContact').ready(function() {
		var contactvue = new Vue({
			el: "#partialContact",
			data: {
				choiceIco: "../../images/gx.png",
				unchoiceIco: "../../images/gx02.png",
				selectedCount: 0,
				contactList: []
			},
			mounted: function() {
				this.$nextTick(function() {
					this.init();
				});
			},
//			computed: {
//				selectedCount: function() {
//					var count = 0;
//					$.each(this.contactList, function(idx, obj) {
//						if(obj.isSelected) {
//							count++;
//						}
//					});
//					return count;
//				}
//			},
			methods: {
				init: function() {
					this.$http.get("../../data/contact.json").then(function(res) {
						var lst = res.data.data;
						$.each(lst, function(idx, obj) {
							obj.isSelected = false;
							//
//							if(vm.atwhos && vm.atwhos.length > 0) {
//								$.each(vm.atwhos, function(i, whos) {
//									if(whos.frendId == obj.frendId && whos.isSelected) {
//										obj.isSelected = true;
//									}
//								})
//							}
						});
						this.contactList = lst;
					});
				},
				choice: function(item) {
					item.isSelected = !item.isSelected
					if(item.isSelected) {
						this.selectedCount++
					} else {
						this.selectedCount--
					}
				},
				selectOK: function() {
					vm.atwhos=[];
					this.contactList.forEach(function(obj, index) {
						if(obj.isSelected) {
							vm.atwhos.push(obj);
						}
					});
					vm.appendAt()
					this.cancel()
				},
				cancel: function() {
					vm.showPopup = false
				}
			}

		})
	})
</script>
var vm = new Vue({
    el: "#app",
    data: {
        urlList: {
            list: "commoditylist.html?id=",
            groupbuy: "../groupbuy/groupbuydetail.html?id=",
            phoneicon: "../../images/telphone.png",
            goicon: "../../images/grey_go.png"
        },
        business: {}

    },
    mounted: function () {//页面加载之后自动调用，常用于页面渲染
        this.$nextTick(function () {//在2.0版本中，加mounted的$nextTick方法，才能使用vm
            this.cartView();
        })
    },
    methods: {
        // 渲染页面
        cartView: function () {
            var _this = this;

            this.$http.get(interfaceUrl + "/live/getBusinessIndex",
			{ userID: userInfo.userID, buildingID: userInfo.buildingID, businessID: getQueryString("id") }).then(function (res) {
			    _this.business = res.data.data;

			    //_this.collection(_this.business.isCollection,_this.business.businessID)
			});
        },
        getMore: function (business) {
            this.$http.get(interfaceUrl + "/live/getMoreGroupBuy",
			{ buildingID: userInfo.buildingID, businessID: getQueryString("id") }).then(function (res) {
			    business.groupBuy = res.data.data;
			    $(".order_whitebox").hide();
			});
        },
        collection: function (business) {

            if (business.isCollection == 0) {
                this.add_collections(business);
            }
            else if (business.isCollection == 1) {
                this.cancel_collections(business);
            }
        },
        add_collections: function (business) {
            var _this = this;
            this.$http.post(path_add,
				{ userID: userInfo.userID, buildingID: userInfo.buildingID, businessID: business.businessID },
				{ emulateJSON: true }).then(function (res) {
				    _this.item = res.data.data;
				    business.isCollection = 1;
				    toast('收藏成功');
				})
        },
        cancel_collections: function (business) {
            var _this = this;
            this.$http.post(path_cancle,
				{ userID: userInfo.userID, buildingID: userInfo.buildingID, businessID: business.businessID },
				{ emulateJSON: true }).then(function (res) {
				    _this.item = res.data.data;
				    business.isCollection = 0;
				    toast('取消收藏');
				})

        }
    }
})